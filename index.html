<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyBYCg_TkGLx8-Eyikn-PWWOdiVj7YjfU4Yr_r87hz_gh2h7yH7pt0LpTgfNvhotdeU7Q/exec";

async function submitForm() {
  const status = document.getElementById("status");
  const btn = document.getElementById("btn");

  // ‚ùó ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ: ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® element ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö
  const nameEl = document.getElementById("name");
  const telEl  = document.getElementById("tel");
  const codeEl = document.getElementById("code");

  const name = nameEl.value.trim();
  const tel  = telEl.value.trim();
  const code = codeEl.value.trim().toUpperCase();

  if (!name || !tel || !code) {
    status.textContent = "‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö";
    status.style.color = "#ef4444";
    return;
  }
  if (!/^AS\d+$/.test(code)) {
    status.textContent = "‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Voucher Code ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
    status.style.color = "#ef4444";
    return;
  }

  btn.disabled = true;
  status.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö...";
  status.style.color = "#93c5fd";

  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ action: "submitCentral", name, tel, code })
    });

    const json = await res.json();

    if (json.ok) {
      showVoucher(json.voucher, json.imgUrl, json.pdfUrl);
    } else {
      status.textContent = json.message || "‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤";
      status.style.color = "#ef4444";
    }

  } catch (e) {
    console.error(e);
    status.textContent = "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ";
    status.style.color = "#ef4444";
  } finally {
    btn.disabled = false;
  }
}

function showVoucher(voucher, imgUrl, pdfUrl) {
  const card = document.getElementById("card");
  card.innerHTML = `
    <h3>üéâ ‡∏£‡∏±‡∏ö Voucher ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h3>
    <div class="hint">‡πÇ‡∏Ñ‡πâ‡∏î: <b>${voucher}</b></div>
    <img class="voucher-img" src="${imgUrl}" />
    <a class="link" href="${pdfUrl}" target="_blank">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF</a>
    <button style="margin-top:12px" onclick="location.reload()">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
  `;
}
</script>