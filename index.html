<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏±‡∏ö Central Voucher</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(1200px 600px at 50% -10%, #1f2a44 0%, #0f172a 55%, #0b1222 100%);
      margin: 0; padding: 16px; min-height: 100vh;
      display: flex; align-items: center; justify-content: center;
      color: #e5e7eb;
    }
    .card {
      width: 100%; max-width: 420px; background: #111827;
      border-radius: 16px; padding: 16px;
      box-shadow: 0 10px 24px rgba(0,0,0,.35);
    }
    h3 { margin: 0 0 12px; text-align: center; }
    input {
      width: 100%; padding: 12px; border-radius: 10px;
      border: 1px solid #1f2937; background: #0b1220;
      color: #e5e7eb; margin-bottom: 10px; font-size: 14px; outline: none;
    }
    button {
      width: 100%; padding: 12px; border: none; border-radius: 10px;
      background: linear-gradient(135deg,#38bdf8,#60a5fa);
      color: #0b1220; font-weight: 700; font-size: 15px; cursor: pointer;
    }
    .hint { font-size: 12px; margin-top: 8px; text-align: center; }
  </style>
</head>
<body>
  <div class="card">
    <h3>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏±‡∏ö Central Voucher 1,200 ‡∏ö‡∏≤‡∏ó</h3>

    <input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" />
    <input id="tel" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£" />
    <input id="code" placeholder="Voucher Code (‡πÄ‡∏ä‡πà‡∏ô AS1005701)" />

    <button id="btn" onclick="submitForm()">‡∏£‡∏±‡∏ö Voucher</button>
    <div class="hint" id="status"></div>
  </div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbyBYCg_TkGLx8-Eyikn-PWWOdiVj7YjfU4Yr_r87hz_gh2h7yH7pt0LpTgfNvhotdeU7Q/exec";

  async function submitForm() {
    const btn = document.getElementById("btn");
    const status = document.getElementById("status");

    const name = document.getElementById("name").value.trim();
    const tel  = document.getElementById("tel").value.trim();
    const code = document.getElementById("code").value.trim().toUpperCase();

    if (!name || !tel || !code) {
      status.textContent = "‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö";
      status.style.color = "#ef4444";
      return;
    }

    btn.disabled = true;
    status.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";
    status.style.color = "#93c5fd";

    try {
      // 1) ‡∏™‡πà‡∏á‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô (‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ)
      await fetch(API_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action:"submitCentral", name, tel, code })
      });

      status.textContent = "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏π‡∏õ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á...";

      // 2) ‡∏Ç‡∏≠ URL ‡∏£‡∏π‡∏õ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ (‡∏≠‡πà‡∏≤‡∏ô JSON ‡πÑ‡∏î‡πâ)
      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action:"getLastVoucherByTel", tel })
      });

      const json = await res.json();
      if (!json.ok) throw new Error(json.message || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏π‡∏õ");

      // 3) ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏π‡∏õ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÑ‡∏°‡πà‡∏ä‡∏ô CORS)
      window.open(json.imgUrl, "_blank");

      status.textContent = "‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏π‡∏õ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß üéâ";

    } catch (e) {
      console.error(e);
      status.textContent = "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ";
      status.style.color = "#ef4444";
    } finally {
      btn.disabled = false;
    }
  }
</script>
</body>
</html>